# AI量化交易策略平台：系统功能说明书

## 1. 项目概述

本项目是一个功能相对完整的、基于Web的A股量化交易策略平台。它整合了从市场扫描、数据获取、特征工程、模型训练、策略回测到结果可视化的完整工作流。系统旨在为量化策略研究提供一个高效、灵活且可扩展的基础框架。


---

## 2. 系统当前功能

系统目前已实现以下四大核心功能模块：

### 2.1. 市场扫描与数据处理层
- **全市场股票筛选 (`scanner.py`)**: 能够实时获取所有A股的行情快照，并根据自定义的多个维度（如股价、市盈率、成交量、市值等）进行自动化选股，生成候选股票池。该模块内置了**网络重试机制**（最多5次，每次间隔5秒），能有效应对临时的网络中断或服务器无响应问题，保证了数据获取的稳定性。
- **个股数据获取 (`data_handler.py`)**: 能够获取指定A股在任意时间范围内的**历史日线行情数据**（前复权）和**核心财务指标**（如PE, PB, 股息率），并支持将两者合并为统一的数据集。

### 2.2. 策略与机器学习模型层
- **丰富的特征工程 (`feature_generator.py`)**: 利用 `pandas-ta` 库为原始数据自动计算数十种常用的技术分析指标（如移动平均线、RSI、MACD、布林带、ATR等），为模型提供强大的特征支持。
- **双模型预测体系 (`model_trainer.py` & `api.py`)**:
    1.  **分类模型 (RandomForestClassifier)**: 用于预测未来N日的股价方向（买入/卖出/持有信号），作为交易信号的决策依据。
    2.  **回归模型 (RandomForestRegressor)**: 用于预测未来N日的具体目标价格，为交易决策提供价格参考。
- **模型持久化**: 训练完成的分类模型会自动使用 `joblib` 保存到本地，便于后续直接调用，无需重复训练。

### 2.3. 策略回测与绩效评估层
- **高仿真回测引擎 (`backtester.py`)**: 提供了一个事件驱动的回测框架，能够模拟真实交易环境。
- **交易成本模拟**: 回测中已考虑了**手续费**和**滑点**，使评估结果更贴近真实情况。
- **仓位管理**: 采用**固定比例**模式（例如，每次用20%的资金买入，或卖出50%的持仓）。
- **全面的性能指标**: 回测结束后，系统会自动计算并展示一系列关键绩效指标，包括：总回报率、年化回报率、夏普比率、最大回撤、交易次数和胜率，为策略评估提供全面的数据支持。

### 2.4. API驱动的应用与交互层
- **Web API接口 (`api.py`)**: 系统通过 `FastAPI` 将核心功能封装成RESTful API，实现了前后端分离。
- **策略动态配置**: 前端（`frontend/` 目录下的React应用）可以通过调用API，动态传入策略配置（如股票代码、回测周期、初始资金、使用的基本面因子等），后端即可实时执行完整的“数据准备 -> 模型训练 -> 策略回测 -> 结果返回”流程。
- **结果可视化**: 后端API会返回格式化的数据，前端可以利用这些数据绘制**K线图**、标注**买卖点**、展示**绩效指标**和**特征重要性**等，实现了策略结果的可视化分析。

---

## 3. 技术架构与核心组件

- **`scanner.py`**: 市场扫描器，负责从数千只股票中筛选出符合初步条件的股票池。
- **`data_handler.py`**: 数据处理器，负责获取指定股票的历史行情和财务数据。
- **`feature_generator.py`**: 特征生成器，为数据添加技术指标。
- **`model_trainer.py`**: 模型训练器，负责训练和保存机器学习模型。
- **`backtester.py`**: 回测引擎，负责模拟交易并评估策略表现。
- **`api.py`**: 应用接口，作为系统的大脑，串联所有模块并为前端提供服务。
- **`main.py`**: 一个独立的命令行执行脚本，用于快速运行单个股票的完整回测流程。
- **`frontend/`**: 一个基于React的Web前端项目，为系统提供图形用户界面。

---

## 4. 技术栈

- **后端**: Python 3.10+, FastAPI
- **前端**: React, JavaScript
- **数据处理**: pandas, numpy
- **数据获取**: akshare
- **特征工程**: pandas-ta
- **机器学习**: scikit-learn, joblib

---

## 5. 未来功能规划

在当前强大的功能基础上，为了进一步提升平台的专业性和实用性，建议后续从以下方向进行迭代：

### 5.1. 增强风控与回测的真实性
- **目标**: 使回测过程更贴近真实交易，并加入核心的风险管理机制。
- **实施**:
    - 在 `backtester.py` 中增加**动态风控逻辑**，例如：
        - **动态止盈止损**: 实现基于价格波动率（如ATR指标）或固定百分比的移动止损/止盈。
        - **更灵活的仓位管理**: 引入除固定比例外的其他资金管理策略，如凯利公式、基于信号强度的仓位调整等。
    - 扩展回测引擎以支持**投资组合级别**的回测，而不仅仅是单只股票。

### 5.2. 迈向自动化交易执行
- **目标**: 打通“决策”与“执行”的最后一公里，让系统能够进行模拟或真实交易。
- **实施**:
    - 研究并选择一家提供交易API的券商（如华泰、国泰君安等）。
    - 创建一个全新的 `trader.py` 模块，作为**交易执行处理器**。
    - 在 `trader.py` 中封装与券商API的交互逻辑，包括：
        - 连接和认证API。
        - **下单**（买入/卖出）。
        - **撤单**。
        - **查询**持仓、资金和委托状态。
    - 将该模块与现有策略逻辑结合，当模型产生信号时，调用 `trader.py` 中的函数来执行相应的交易操作。

### 5.3. 提升策略的深度与广度
- **目标**: 引入更多维度的数据和更复杂的模型，以发掘更有效的交易逻辑。
- **实施**:
    - **多因子模型**: 引入除技术指标外的更多因子，如宏观经济数据、行业数据、舆情数据、高频因子等。
    - **高级模型**: 尝试除随机森林外的其他机器学习或深度学习模型，如LightGBM, XGBoost, LSTM等，并对模型进行超参数优化。
    - **策略优化器**: 开发一个可以对策略参数（如指标参数、交易阈值）进行自动化寻优的模块。
