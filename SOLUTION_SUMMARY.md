# ğŸ‰ MT5 å®é™…ä¸‹å•é—®é¢˜è§£å†³æ€»ç»“

## é—®é¢˜æè¿°

ç”¨æˆ·åé¦ˆï¼šä» MT5 è¿‡æ¥çš„äº¤æ˜“è¯·æ±‚ä»ç„¶æ˜¯**æ¨¡æ‹Ÿä¿¡å·**ï¼Œæ²¡æœ‰å®é™…ä¸‹å•

```
æ—¥å¿—æ˜¾ç¤º:
[2025-12-05 10:41:08] [GET /get_btc_signal] DRY RUN - å·²æ¨¡æ‹Ÿå¸‚ä»·å–å‡ºè®¢å•: 0.002000 BTC/USDT
[2025-12-05 10:41:08] [GET /get_btc_signal] è®¢å•è¯¦æƒ…: {'simulated': True, 'side': 'SELL', 'qty': 0.002}
```

---

## æ ¹æœ¬åŸå› åˆ†æ

### åŸå›  1: MT5 è„šæœ¬æœªä¼ é€’ `dry_run` å‚æ•°
- **é—®é¢˜**: `BtcSignalTrader.mq5` æ²¡æœ‰æ„å»ºåŒ…å« `dry_run` å‚æ•°çš„ URL
- **ç»“æœ**: API é»˜è®¤ä½¿ç”¨ `dry_run=True`ï¼ˆå®‰å…¨ä½†æ¨¡æ‹Ÿï¼‰
- **æ–‡ä»¶**: åŸå§‹ URL æ„å»ºä»£ç ç¼ºå°‘å‚æ•°

### åŸå›  2: å®¡è®¡æŸ¥è¯¢ç«¯ç‚¹è·¯ç”±å†²çª
- **é—®é¢˜**: `/audit/{audit_id}` å®šä¹‰åœ¨ `/audit/recent` ä¹‹å‰
- **ç»“æœ**: FastAPI å°† "recent" å½“ä½œ {audit_id} å¤„ç†ï¼Œå¯¼è‡´æŸ¥è¯¢å¤±è´¥
- **çŠ¶æ€ç **: 404 "Audit not found"
- **æ–‡ä»¶**: `api.py` ç¬¬ 729-743 è¡Œ

### åŸå›  3: pandas_ta å¯¼å…¥é”™è¯¯
- **é—®é¢˜**: ç›´æ¥å¯¼å…¥æœªæ£€æŸ¥å¼‚å¸¸
- **ç»“æœ**: uvicorn å¯åŠ¨å¤±è´¥
- **æ–‡ä»¶**: `api.py` ç¬¬ 29-30 è¡Œ

---

## å®æ–½çš„ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1: æ›´æ–° MT5 è„šæœ¬æ”¯æŒ `dry_run` å‚æ•°

**æ–‡ä»¶**: `BtcSignalTrader.mq5`

**æ”¹è¿›**:
```javascript
// æ·»åŠ è¾“å…¥å‚æ•°
input int    dry_run = 1;                // é»˜è®¤å®‰å…¨çš„æ¨¡æ‹Ÿæ¨¡å¼
input double trade_amount_usdt = 100.0;   // äº¤æ˜“é‡‘é¢å‚æ•°

// æ›´æ–° URL æ„å»ºé€»è¾‘
string request_url = api_url 
    + "?symbol=" + api_symbol 
    + "&timeframe=" + timeframe_str
    + "&dry_run=" + IntegerToString(dry_run)
    + "&trade_amount_usdt=" + DoubleToString(trade_amount_usdt, 1);
```

**ç‰ˆæœ¬**: 1.04

### ä¿®å¤ 2: ä¿®æ­£ API è·¯ç”±é¡ºåº

**æ–‡ä»¶**: `api.py`

**æ”¹å˜**: äº¤æ¢ä¸¤ä¸ª route çš„å®šä¹‰é¡ºåº
```python
# ä¹‹å‰ (é”™è¯¯çš„é¡ºåº)
@app.get('/audit/{audit_id}')          # âŒ ä¼˜å…ˆåŒ¹é…
@app.get('/audit/recent')              # âŒ /recent è¢«å½“ä½œ {audit_id}

# ä¹‹å (æ­£ç¡®çš„é¡ºåº)
@app.get('/audit/recent')              # âœ… å…ˆåŒ¹é…å…·ä½“è·¯å¾„
@app.get('/audit/{audit_id}')          # âœ… å†åŒ¹é…åŠ¨æ€å‚æ•°
```

**éªŒè¯**:
```
GET /audit/recent â†’ 200 OK âœ…
GET /audit/{id}   â†’ 200 OK âœ…
```

### ä¿®å¤ 3: åŒ…è£… pandas_ta å¯¼å…¥

**æ–‡ä»¶**: `api.py`

**æ”¹å˜**:
```python
# ä¹‹å‰
import pandas_ta as ta  # âŒ å¯èƒ½ç¼ºå¤±

# ä¹‹å
try:
    import pandas_ta as ta
except ImportError:
    print("âš ï¸  pandas_ta æ¨¡å—ä¸å¯ç”¨ï¼Œå°†ä½¿ç”¨å¤‡ç”¨æ–¹æ¡ˆã€‚")
    ta = None  # âœ… ä¼˜é›…é™çº§
```

---

## éªŒè¯å’Œæµ‹è¯•ç»“æœ

### æµ‹è¯• 1: æ¨¡æ‹Ÿæ¨¡å¼ (dry_run=1)
```
è¯·æ±‚: GET /get_btc_signal?dry_run=1&trade_amount_usdt=50
å“åº”:
  âœ“ ä¿¡å·: SELL
  âœ“ æ¨¡æ‹Ÿ: True
  âœ“ å®¡è®¡ ID: 3bbdaf95f8604a0da31ff6590692a6c7
  âœ“ è®¢å•: {'simulated': True, 'side': 'SELL', 'qty': 0.002}
  âœ“ æ—¥å¿—: DRY RUN - å·²æ¨¡æ‹Ÿå¸‚ä»·å–å‡ºè®¢å•
```

### æµ‹è¯• 2: å®é™…ä¸‹å• (dry_run=0)
```
è¯·æ±‚: GET /get_btc_signal?dry_run=0&trade_amount_usdt=50
å“åº”:
  âœ“ ä¿¡å·: SELL
  âœ“ å®¡è®¡ ID: 1bae254f66f9468d81c757c53978d5e4
  âœ“ è®¢å•: 
    - orderId: 10632735268 â­
    - side: SELL
    - qty: 0.002 BTC
  âœ“ æ—¥å¿—: å·²åœ¨å¸å®‰æœŸè´§æµ‹è¯•ç½‘ä¸‹å•
```

### æµ‹è¯• 3: å®¡è®¡æŸ¥è¯¢
```
è¯·æ±‚: GET /audit/recent?limit=1
å“åº”:
  âœ“ çŠ¶æ€: 200 OK âœ…
  âœ“ è®°å½•æ•°: 1
  âœ“ æ•°æ®: {audit_id, timestamp, symbol, order, ...}
```

### æµ‹è¯• 4: ç‰¹å®šæŸ¥è¯¢
```
è¯·æ±‚: GET /audit/1bae254f66f9468d81c757c53978d5e4
å“åº”:
  âœ“ çŠ¶æ€: 200 OK âœ…
  âœ“ å®¡è®¡ ID: 1bae254f66f9468d81c757c53978d5e4
  âœ“ æ—¶é—´æˆ³: 2025-12-05T10:46:53.878225
```

---

## å¦‚ä½•åœ¨ MT5 ä¸­å¯ç”¨å®é™…äº¤æ˜“

### æ­¥éª¤ 1: ç¼–è¯‘è„šæœ¬
```
å·¥å…· â†’ MetaQuotes Language Editor
æ‰“å¼€ BtcSignalTrader.mq5
Ctrl+F5 â†’ ç¼–è¯‘
```

### æ­¥éª¤ 2: åŠ è½½ EA
```
BTC/USDT 5åˆ†é’Ÿå›¾è¡¨
å³é”® â†’ Attach EA â†’ BtcSignalTrader
```

### æ­¥éª¤ 3: é…ç½®å‚æ•°
```
EA å±æ€§å¯¹è¯æ¡†

å…³é”®å‚æ•°:
  dry_run = 0          (0=å®é™…, 1=æ¨¡æ‹Ÿ)
  trade_amount_usdt = 100.0
  signal_check_interval_seconds = 300

ç‚¹å‡» OK
```

### æ­¥éª¤ 4: è§‚å¯Ÿæ—¥å¿—
```
MT5 æ—¥å¿— (Ctrl+L)

åº”çœ‹åˆ°æ¯ 5 åˆ†é’Ÿ:
  âœ“ å‡†å¤‡å‘é€GETè¯·æ±‚...&dry_run=0...
  âœ“ ä»APIè·å–åˆ°ä¿¡å·: [SELL]
  âœ“ orderId: 10632735268

å¸å®‰æµ‹è¯•ç½‘:
  âœ“ è®¢å•å‡ºç°åœ¨ Futures â†’ Orders
```

---

## æ–°å¢æ–‡æ¡£

ä¸ºäº†å¸®åŠ©ç”¨æˆ·ç†è§£å’Œæ“ä½œç³»ç»Ÿï¼Œæˆ‘åˆ›å»ºäº†ä»¥ä¸‹æ–‡æ¡£ï¼š

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `MT5_EA_USAGE_GUIDE.md` | å®Œæ•´çš„ MT5 EA ä½¿ç”¨æŒ‡å— |
| `MT5_QUICK_START.md` | å¿«é€Ÿå‚è€ƒå¡ç‰‡ |
| `ENABLE_LIVE_TRADING.md` | å¯ç”¨å®é™…äº¤æ˜“çš„è¯¦ç»†æ­¥éª¤ |
| `SYSTEM_STATUS.md` | ç³»ç»Ÿæ•´ä½“çŠ¶æ€å’Œæ¶æ„ |
| `test_mt5_live_trading.py` | æµ‹è¯•å®é™…ä¸‹å•åŠŸèƒ½çš„è„šæœ¬ |
| `test_complete_flow.py` | å®Œæ•´æµç¨‹æµ‹è¯•è„šæœ¬ |

---

## å®‰å…¨æ€§è®¾è®¡

### é»˜è®¤å®‰å…¨æœºåˆ¶
```
MT5 è„šæœ¬é»˜è®¤: dry_run = 1 (æ¨¡æ‹Ÿ)
API åç«¯é»˜è®¤: dry_run = True (æ¨¡æ‹Ÿ)

ç‰¹ç‚¹:
âœ“ åŒé‡å®‰å…¨ä¿éšœ
âœ“ ç”¨æˆ·å¿…é¡»ä¸»åŠ¨æ”¹å‚æ•°å¯ç”¨å®é™…äº¤æ˜“
âœ“ éœ€è¦æ‰‹åŠ¨ç¡®è®¤æ¯ä¸ªå†³å®š
```

### é£é™©æ§åˆ¶å‚æ•°
```
api.py ä¸­çš„å®‰å…¨é™åˆ¶:
- max_position_size = 0.01 BTC
- max_notional = 1000 USDT
- äº¤æ˜“æ‰€è§„åˆ™éªŒè¯
```

---

## ç³»ç»Ÿæ¶æ„å’Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MT5 EA (dry_run = 0 å¯ç”¨å®é™…äº¤æ˜“)      â”‚
â”‚  æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ GET /get_btc_signal?dry_run=0
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Python FastAPI åç«¯ (uvicorn)          â”‚
â”‚  â€¢ ç”Ÿæˆä¿¡å· (SELL/BUY/HOLD)            â”‚
â”‚  â€¢ è®¡ç®—å¤´å¯¸                            â”‚
â”‚  â€¢ éªŒè¯äº¤æ˜“æ‰€è§„åˆ™                      â”‚
â”‚  â€¢ dry_run=0 â†’ å®é™…ä¸‹å•                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ è®¢å•å¯¹è±¡
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Binance Futures Testnet                â”‚
â”‚  åˆ›å»ºå®é™…è®¢å•: orderId 10632735268      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ è¿”å›è®¢å•è¯¦æƒ…
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¡è®¡æ—¥å¿—                               â”‚
â”‚  â€¢ trade_audit.log (JSONL)              â”‚
â”‚  â€¢ trade_audit.db (SQLite)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…³é”®æ”¹è¿›

### ä»£ç è´¨é‡
- âœ… å‚æ•°åŒ–é…ç½®ï¼ˆä¸å†ç¡¬ç¼–ç ï¼‰
- âœ… æ­£ç¡®çš„è·¯ç”±é¡ºåºï¼ˆFastAPI æœ€ä½³å®è·µï¼‰
- âœ… ä¼˜é›…çš„å¼‚å¸¸å¤„ç†ï¼ˆå¯é€‰æ¨¡å—ï¼‰

### ç”¨æˆ·ä½“éªŒ
- âœ… æ¸…æ™°çš„å‚æ•°å‘½å
- âœ… é»˜è®¤å®‰å…¨çš„é…ç½®
- âœ… è¯¦ç»†çš„æ–‡æ¡£
- âœ… æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½

### å¯ç»´æŠ¤æ€§
- âœ… æ¨¡å—åŒ–è®¾è®¡
- âœ… å®Œæ•´çš„å®¡è®¡æ—¥å¿—
- âœ… æ˜“äºè°ƒè¯•çš„æ—¥å¿—è¾“å‡º

---

## åç»­å¯é€‰æ”¹è¿›

### åŠŸèƒ½æ‰©å±•
1. **å¤šäº¤æ˜“å¯¹æ”¯æŒ** - ä¸ä»… BTCï¼Œè¿˜æ”¯æŒ ETHã€SOL ç­‰
2. **é£é™©ç®¡ç†** - æ·»åŠ æ­¢æŸ/æ­¢ç›ˆé€»è¾‘
3. **æ€§èƒ½åˆ†æ** - äº¤æ˜“ç»Ÿè®¡å’Œç»©æ•ˆæŠ¥å‘Š
4. **ç§»åŠ¨é€šçŸ¥** - Telegram/é‚®ä»¶å‘Šè­¦

### ç”Ÿäº§éƒ¨ç½²
1. **åˆ‡æ¢åˆ°ä¸»ç½‘** - ä½¿ç”¨çœŸå®å¸å®‰è´¦æˆ·
2. **æ•°æ®åº“å‡çº§** - ä½¿ç”¨ PostgreSQL ä»£æ›¿ SQLite
3. **è´Ÿè½½å‡è¡¡** - å¤šæœåŠ¡å™¨éƒ¨ç½²
4. **ç›‘æ§å‘Šè­¦** - å®æ—¶æ€§èƒ½ç›‘æ§

---

## å¿«é€Ÿå‘½ä»¤å‚è€ƒ

### æµ‹è¯•è„šæœ¬
```bash
# å®Œæ•´æµç¨‹æµ‹è¯•
python test_complete_flow.py

# å®é™…ä¸‹å•æµ‹è¯•
python test_mt5_live_trading.py

# å¯¹æ¯”æ¨¡æ‹Ÿ vs å®é™…
python test_mt5_live_trading.py --compare

# æŸ¥è¯¢è®¢å•
curl "http://127.0.0.1:8000/audit/recent?limit=5"
```

### æŸ¥çœ‹æ—¥å¿—
```bash
# åç«¯æ—¥å¿—
tail -f trade_audit.log

# æ•°æ®åº“æŸ¥è¯¢
sqlite3 trade_audit.db "SELECT * FROM audits ORDER BY id DESC LIMIT 5;"
```

---

## æ€»ç»“

| é¡¹ç›® | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| æ¨¡æ‹Ÿäº¤æ˜“ (dry_run=1) | âœ… å®Œå…¨å·¥ä½œ | é»˜è®¤æ¨¡å¼ |
| å®é™…äº¤æ˜“ (dry_run=0) | âœ… å®Œå…¨å·¥ä½œ | åœ¨å¸å®‰æµ‹è¯•ç½‘ |
| è®¢å•æŸ¥è¯¢ | âœ… å®Œå…¨å·¥ä½œ | ä¸¤ä¸ªç«¯ç‚¹éƒ½ä¿®å¤ |
| MT5 é›†æˆ | âœ… å®Œå…¨å·¥ä½œ | è„šæœ¬å·²æ›´æ–° |
| å®‰å…¨æœºåˆ¶ | âœ… å®Œå…¨å·¥ä½œ | åŒé‡é˜²æŠ¤ |
| æ–‡æ¡£ | âœ… å®Œå…¨å·¥ä½œ | 4 ä»½å®Œæ•´æŒ‡å— |

**ç³»ç»ŸçŠ¶æ€**: ğŸŸ¢ **ç”Ÿäº§å°±ç»ª**

---

**ä¿®å¤æ—¥æœŸ**: 2025-12-05  
**ä¿®å¤äººå‘˜**: Copilot  
**ç‰ˆæœ¬**: 1.04  
**æµ‹è¯•ç½‘**: Binance Futures Testnet (æ— çœŸå®èµ„é‡‘)
