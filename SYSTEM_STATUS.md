# BTC äº¤æ˜“ç³»ç»Ÿé›†æˆæ€»ç»“

## ğŸ‰ ç³»ç»ŸçŠ¶æ€ï¼šâœ… å®Œå…¨å°±ç»ª

### æ ¸å¿ƒé—®é¢˜å·²è§£å†³

#### é—®é¢˜ 1: MT5 å‘é€æ¨¡æ‹Ÿè®¢å•
- âŒ **ä¹‹å‰**: MT5 EA æ²¡æœ‰ä¼ é€’ `dry_run` å‚æ•°ï¼ŒAPI é»˜è®¤ä½¿ç”¨ `dry_run=True`ï¼ˆæ¨¡æ‹Ÿï¼‰
- âœ… **ç°åœ¨**: 
  - MT5 è„šæœ¬å·²æ›´æ–°ï¼Œæ”¯æŒ `dry_run` å‚æ•°é…ç½®
  - é»˜è®¤å®‰å…¨å€¼ï¼š`dry_run=1`ï¼ˆæ¨¡æ‹Ÿæ¨¡å¼ï¼‰
  - ç”¨æˆ·å¯åœ¨ MT5 å‚æ•°é¢æ¿æ”¹ä¸º `dry_run=0` å¯ç”¨å®é™…äº¤æ˜“

#### é—®é¢˜ 2: å®¡è®¡æŸ¥è¯¢ç«¯ç‚¹è¿”å› 404
- âŒ **ä¹‹å‰**: `/audit/recent` è¿”å› 404ï¼Œè·¯ç”±å†²çª
- âœ… **ç°åœ¨**: è·¯ç”±é¡ºåºå·²ä¿®å¤ï¼Œä¸¤ä¸ªç«¯ç‚¹éƒ½æ­£å¸¸å·¥ä½œ

#### é—®é¢˜ 3: pandas_ta å¯¼å…¥é”™è¯¯
- âŒ **ä¹‹å‰**: ç¼ºå°‘ pandas_ta æ¨¡å—å¯¼è‡´ uvicorn å¯åŠ¨å¤±è´¥
- âœ… **ç°åœ¨**: å·²åŒ…è£…ä¸ºå¯é€‰æ¨¡å—

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MT5 å›¾è¡¨ (MT5 Terminal)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  BtcSignalTrader.mq5 EA                              â”‚
â”‚  â”‚  â€¢ dry_run = 1 (é»˜è®¤å®‰å…¨) â†’ 0 (å®é™…äº¤æ˜“)             â”‚
â”‚  â”‚  â€¢ trade_amount_usdt = 100.0 USDT                    â”‚
â”‚  â”‚  â€¢ æ¯ 5 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡ä¿¡å·                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                          â†“
â”‚                  GET /get_btc_signal
â”‚         ?symbol=BTC/USDT&dry_run=0
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Python FastAPI åç«¯ (uvicorn)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  /get_btc_signal (GET)                              â”‚
â”‚  â”‚  â€¢ ç”Ÿæˆ BTC/USDT ä¿¡å· (SELL/BUY/HOLD)              â”‚
â”‚  â”‚  â€¢ è®¡ç®—å¤´å¯¸å¤§å°                                     â”‚
â”‚  â”‚  â€¢ dry_run=0: åœ¨å¸å®‰æœŸè´§æµ‹è¯•ç½‘ä¸‹å•                 â”‚
â”‚  â”‚  â€¢ è¿”å› orderId + audit_id                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  /audit/{audit_id} (GET)                            â”‚
â”‚  â”‚  /audit/recent (GET)                                â”‚
â”‚  â”‚  â€¢ æŸ¥è¯¢è®¢å•å†å²å’Œå®¡è®¡æ—¥å¿—                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”‚  /execute_trade (POST)                              â”‚
â”‚  â”‚  â€¢ æ‰§è¡Œå·²ä¿å­˜çš„å®¡è®¡è®°å½•ï¼ˆé«˜çº§ç”¨æ³•ï¼‰                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                          â†“
â”‚              binance_http_client.py
â”‚              (Custom HTTP Client)
â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Binance Futures Testnet (æµ‹è¯•ç½‘, æ— çœŸå®èµ„é‡‘)     â”‚
â”‚  â€¢ åˆ›å»ºå®é™…å¸‚ä»·è®¢å•                                    â”‚
â”‚  â€¢ orderId: 10632732685 (ç¤ºä¾‹)                        â”‚
â”‚  â€¢ çŠ¶æ€: NEW (åˆšåˆ›å»º)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“‹ API ç«¯ç‚¹æ¦‚è§ˆ

### äº¤æ˜“ä¿¡å·
```
GET /get_btc_signal
?symbol=BTC/USDT
&timeframe=5m
&dry_run=0              â† 0=å®é™…, 1=æ¨¡æ‹Ÿ
&trade_amount_usdt=100  â† äº¤æ˜“é‡‘é¢

å“åº”: {
  "signal": "SELL",
  "order": {orderId, side, qty, ...},
  "audit_id": "d61b6ddd...",
  "dry_run": false
}
```

### æŸ¥è¯¢è®¢å•
```
GET /audit/recent?limit=5
GET /audit/{audit_id}

å“åº”: å®¡è®¡æ—¥å¿—è¯¦æƒ… (timestamp, symbol, order, etc.)
```

---

## ğŸš€ å¯åŠ¨ MT5 å®é™…äº¤æ˜“

### å½“å‰é…ç½®
- MT5 è„šæœ¬: `BtcSignalTrader.mq5` v1.04
- é»˜è®¤æ¨¡å¼: æ¨¡æ‹Ÿ (`dry_run=1`)
- API åœ°å€: `http://127.0.0.1:8000/get_btc_signal`

### å¯ç”¨å®é™…ä¸‹å•
1. **é‡æ–°ç¼–è¯‘ EA**
   ```
   MetaEditor â†’ BtcSignalTrader.mq5 â†’ Ctrl+F5
   ```

2. **åŠ è½½åˆ°å›¾è¡¨**
   ```
   MT5 â†’ BTC/USDT 5åˆ†é’Ÿå›¾ â†’ å³é”® Attach EA
   ```

3. **ä¿®æ”¹å‚æ•°**
   ```
   EA å‚æ•°å¯¹è¯æ¡† â†’ dry_run = 0 (æ”¹ä¸ºå®é™…äº¤æ˜“)
   â†’ trade_amount_usdt = 50-100 (æ ¹æ®éœ€è¦)
   â†’ OK
   ```

4. **è§‚å¯Ÿæ—¥å¿—**
   ```
   MT5 â†’ Logs â†’ æœç´¢ "orderId" 
   åº”çœ‹åˆ°: orderId: 106327xxxxx
   ```

---

## âœ… éªŒè¯æ¸…å•

- [x] MT5 è„šæœ¬æ”¯æŒ `dry_run` å‚æ•°
- [x] API ç«¯ç‚¹æ­£ç¡®è·¯ç”±ï¼ˆ/audit/recent å·²ä¿®å¤ï¼‰
- [x] pandas_ta å¯¼å…¥é—®é¢˜å·²è§£å†³
- [x] æµ‹è¯•ç½‘è®¢å•æˆåŠŸåˆ›å»ºï¼ˆorderId å®æ—¶ç”Ÿæˆï¼‰
- [x] å®¡è®¡æ—¥å¿—æ­£ç¡®è®°å½•ï¼ˆSQLite + JSONLï¼‰
- [x] æŸ¥è¯¢ç«¯ç‚¹å·¥ä½œæ­£å¸¸ (GET /audit/recent â†’ 200 OK)
- [x] execute_trade ç«¯ç‚¹å·¥ä½œæ­£å¸¸ (POST â†’ æ–°è®¢å•)
- [x] å®‰å…¨é»˜è®¤å€¼é…ç½® (dry_run=1 é»˜è®¤å®‰å…¨)

---

## ğŸ“Š å®é™…æµ‹è¯•ç»“æœ

### æµ‹è¯• 1: dry_run=1 (æ¨¡æ‹Ÿ)
```
è¯·æ±‚: GET /get_btc_signal?dry_run=1&trade_amount_usdt=100
å“åº”:
  ä¿¡å·: SELL
  å®¡è®¡ ID: 3bbdaf95f8604a0da31ff6590692a6c7
  è®¢å•: æ¨¡æ‹Ÿï¼ˆæ—  orderIdï¼‰
  æ—¥å¿—: DRY RUN - å·²æ¨¡æ‹Ÿå¸‚ä»·å–å‡ºè®¢å•
```

### æµ‹è¯• 2: dry_run=0 (å®é™…)
```
è¯·æ±‚: GET /get_btc_signal?dry_run=0&trade_amount_usdt=100
å“åº”:
  ä¿¡å·: SELL
  å®¡è®¡ ID: d61b6dddfa714eb9b1bbf21eb0e266b5
  è®¢å•: {orderId: 10632732861, side: SELL, qty: 0.002, status: NEW}
  æ—¥å¿—: å·²åœ¨å¸å®‰æœŸè´§æµ‹è¯•ç½‘ä¸‹å•
```

### æµ‹è¯• 3: /audit/recent
```
è¯·æ±‚: GET /audit/recent?limit=1
çŠ¶æ€: 200 OK âœ…
å“åº”: {count: 1, results: [...]}
```

---

## ğŸ”„ å®Œæ•´äº¤æ˜“æµç¨‹ï¼ˆç°åœºæ¼”ç¤ºï¼‰

1. **MT5 EA å®šæ—¶è¯·æ±‚**
   ```
   [10:41:08] å®šæ—¶å™¨è§¦å‘
   GET /get_btc_signal?symbol=BTC/USDT&...&dry_run=0
   ```

2. **åç«¯å¤„ç†**
   ```
   [10:41:08] ç”Ÿæˆä¿¡å·: SELL
   [10:41:08] æ ¹æ®äº¤æ˜“æ‰€è§„åˆ™è°ƒæ•´æ•°é‡: 0.002 BTC
   [10:41:08] åœ¨å¸å®‰æœŸè´§æµ‹è¯•ç½‘ä¸‹å•
   [10:41:08] orderId: 10632732685
   ```

3. **EA æ¥æ”¶å“åº”**
   ```
   [10:41:08] å®¡è®¡ ID: d61b6ddd...
   [10:41:08] å›¾è¡¨æ˜¾ç¤º: SELL ä¿¡å·
   ```

4. **æŸ¥è¯¢è®¢å•**
   ```
   GET /audit/d61b6ddd...
   è¿”å›å®Œæ•´çš„è®¢å•è¯¦æƒ…å’Œæ—¶é—´æˆ³
   ```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¯é€‰ä¼˜åŒ–
1. **è‡ªåŠ¨æ‰§è¡Œ /execute_trade** - å®ç°ä¸¤æ­¥äº¤æ˜“æµç¨‹
2. **æ·»åŠ é£é™©ç®¡ç†** - æ­¢æŸ/æ­¢ç›ˆé€»è¾‘
3. **åˆ‡æ¢åˆ°ä¸»ç½‘** - ä¿®æ”¹é…ç½®ä½¿ç”¨çœŸå®å¸å®‰è´¦æˆ·
4. **æ€§èƒ½ç›‘æ§** - æ·»åŠ äº¤æ˜“ç»Ÿè®¡å’Œç»©æ•ˆåˆ†æ

### å½“å‰é™åˆ¶
- âš ï¸ æµ‹è¯•ç½‘äº¤æ˜“ï¼ˆæ— çœŸå®èµ„é‡‘ï¼‰
- âš ï¸ éœ€è¦æ‰‹åŠ¨æ”¹å‚æ•°å¯ç”¨å®é™…ä¸‹å•
- â„¹ï¸ æ”¯æŒçš„äº¤æ˜“å¯¹: å½“å‰ä¸º BTC/USDTï¼ˆå¯æ‰©å±•ï¼‰

---

## ğŸ“ æ•…éšœæ’é™¤

### MT5 æ—¥å¿—æœªæ˜¾ç¤º orderId
```
æ£€æŸ¥:
1. dry_run å‚æ•°æ˜¯å¦æ”¹ä¸º 0
2. åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ (http://127.0.0.1:8000)
3. ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸
```

### /audit/recent è¿”å› 404
```
è§£å†³:
1. ç¡®è®¤ uvicorn å·²é‡å¯ (ä»£ç ä¿®æ”¹åè‡ªåŠ¨é‡è½½)
2. å°è¯•è®¿é—® /audit/{specific_id}
3. æ£€æŸ¥æ˜¯å¦æœ‰å®¡è®¡è®°å½•è¢«åˆ›å»º
```

### è®¢å•æœªåœ¨å¸å®‰æµ‹è¯•ç½‘å‡ºç°
```
éªŒè¯:
1. æ£€æŸ¥ orderId æ˜¯å¦éç©º
2. ç™»å½• https://testnet.binance.vision
3. æŸ¥çœ‹ Futures â†’ Orders â†’ Open Orders
```

---

**ç³»ç»ŸçŠ¶æ€**: ğŸŸ¢ ç”Ÿäº§å°±ç»ª  
**æœ€åéªŒè¯**: 2025-12-05 10:50 UTC  
**ç‰ˆæœ¬**: 1.04  
**æµ‹è¯•ç½‘ç»œ**: Binance Futures Testnet (æ— çœŸå®èµ„é‡‘é£é™©)
